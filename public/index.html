<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Koroi Drama</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root{
--bg:#0e0e13;
--surface:#181820;
--accent:#ff003c;
--text:#ffffff;
--muted:#9aa0a6;
--glass:rgba(255,255,255,0.05);
}
*{box-sizing:border-box}
body{
margin:0;
font-family:'Poppins',sans-serif;
background:radial-gradient(circle at top left,#1a1a30,#0e0e13 40%);
color:var(--text);
overflow-x:hidden;
}

/* ACCESS SCREEN */
#blocked{
display:flex;
height:100vh;
align-items:center;
justify-content:center;
flex-direction:column;
text-align:center;
background:#000;
}
#blocked h1{
font-size:32px;
color:var(--accent);
}

/* HEADER */
header{
display:flex;
justify-content:space-between;
align-items:center;
padding:20px 5%;
position:sticky;
top:0;
backdrop-filter:blur(15px);
background:rgba(0,0,0,0.5);
z-index:100;
}
header h1{
margin:0;
font-weight:700;
background:linear-gradient(90deg,#ff003c,#ff5f6d);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
}

/* HERO */
.hero{
position:relative;
height:55vh;
display:flex;
align-items:flex-end;
padding:40px 5%;
background-size:cover;
background-position:center;
border-bottom:1px solid #222;
}
.hero::after{
content:"";
position:absolute;
inset:0;
background:linear-gradient(to top,rgba(0,0,0,0.9),rgba(0,0,0,0.2));
}
.hero-content{
position:relative;
z-index:2;
max-width:600px;
}
.hero h2{
margin:0 0 10px;
font-size:32px;
}
.hero button{
background:var(--accent);
border:none;
padding:12px 20px;
color:white;
font-weight:600;
border-radius:6px;
cursor:pointer;
}

/* CATEGORY */
.section{
padding:30px 5%;
}
.section h3{
margin-bottom:15px;
}
.row{
display:flex;
gap:15px;
overflow-x:auto;
scroll-behavior:smooth;
}
.card{
min-width:180px;
background:var(--surface);
border-radius:10px;
overflow:hidden;
cursor:pointer;
transition:0.3s;
}
.card:hover{
transform:scale(1.07);
box-shadow:0 10px 20px rgba(0,0,0,0.6);
}
.card img{
width:100%;
height:250px;
object-fit:cover;
}
.card p{
padding:10px;
font-size:14px;
white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis;
}

/* PLAYER PAGE */
#playerPage{
display:none;
padding:20px 5%;
animation:fadeIn 0.3s ease;
}
video{
width:100%;
max-height:75vh;
border-radius:10px;
background:black;
}
.episode-list{
display:flex;
flex-wrap:wrap;
gap:10px;
margin-top:20px;
}
.episode{
background:var(--glass);
padding:10px 15px;
border-radius:6px;
cursor:pointer;
transition:0.2s;
}
.episode:hover{
background:var(--accent);
}
.episode.active{
background:var(--accent);
font-weight:bold;
}

@keyframes fadeIn{
from{opacity:0}
to{opacity:1}
}
</style>
</head>
<body>

<div id="blocked">
<h1>Access Denied</h1>
<p>Gunakan link khas untuk masuk.</p>
</div>

<div id="app" style="display:none">

<header>
<h1>Koroi Drama</h1>
<button onclick="goHome()">Home</button>
</header>

<div class="hero" id="hero"></div>

<div id="homepage"></div>

<div id="playerPage">
<h2 id="videoTitle"></h2>
<video id="videoPlayer" controls></video>
<div class="episode-list" id="episodeList"></div>
</div>

</div>

<script>
const ACCESS_KEY="koroi2026";
const apiBase="/api/proxy";

const params=new URLSearchParams(window.location.search);
const access=params.get("access");

if(access===ACCESS_KEY || sessionStorage.getItem("access")==="true"){
sessionStorage.setItem("access","true");
document.getElementById("blocked").style.display="none";
document.getElementById("app").style.display="block";
history.replaceState({},document.title,window.location.pathname);
loadHome();
}else{
document.getElementById("blocked").style.display="flex";
}

async function apiCall(endpoint){
const target=`https://captain.sapimu.au${endpoint}?lang=in`;
const res=await fetch(`${apiBase}?url=${encodeURIComponent(target)}`);
return await res.json();
}

async function loadHome(){
const container=document.getElementById("homepage");
container.innerHTML="Loading...";
const res=await apiCall("/dramabox/api/v1/new/1?pageSize=20");
container.innerHTML="";
if(res?.data?.list){
createSection("Terbaru",res.data.list);
setHero(res.data.list[0]);
}
}

function setHero(item){
const hero=document.getElementById("hero");
hero.style.backgroundImage=`url(${item.cover})`;
hero.innerHTML=`
<div class="hero-content">
<h2>${item.bookName}</h2>
<button onclick="openDetails(${item.bookId},'${item.bookName.replace(/'/g,"")}')">Tonton Sekarang</button>
</div>
`;
}

function createSection(title,data){
const section=document.createElement("div");
section.className="section";
section.innerHTML=`<h3>${title}</h3><div class="row"></div>`;
const row=section.querySelector(".row");
data.forEach(item=>{
const card=document.createElement("div");
card.className="card";
card.innerHTML=`<img src="${item.cover}"><p>${item.bookName}</p>`;
card.onclick=()=>openDetails(item.bookId,item.bookName);
row.appendChild(card);
});
document.getElementById("homepage").appendChild(section);
}

async function openDetails(bookId,title){
document.getElementById("homepage").style.display="none";
document.getElementById("hero").style.display="none";
document.getElementById("playerPage").style.display="block";
document.getElementById("videoTitle").textContent=title;

const res=await apiCall(`/dramabox/api/v1/chapters/${bookId}`);
const episodes=res?.data?.chapterList||[];
const list=document.getElementById("episodeList");
list.innerHTML="";
episodes.forEach(ep=>{
const div=document.createElement("div");
div.className="episode";
div.textContent="Ep "+(ep.chapterIndex+1);
div.onclick=()=>playVideo(bookId,ep.chapterIndex,div);
list.appendChild(div);
});
if(episodes.length>0) playVideo(bookId,0,list.children[0]);
}

async function playVideo(bookId,index,element){
const res=await apiCall(`/dramabox/api/v1/watch/${bookId}/${index}`);
const url=res?.data?.videoUrl;
if(!url) return;

document.querySelectorAll(".episode").forEach(e=>e.classList.remove("active"));
if(element) element.classList.add("active");

const video=document.getElementById("videoPlayer");

if(Hls.isSupported()){
const hls=new Hls();
hls.loadSource(url);
hls.attachMedia(video);
}else{
video.src=url;
}
video.play();
}

function goHome(){
document.getElementById("homepage").style.display="block";
document.getElementById("hero").style.display="flex";
document.getElementById("playerPage").style.display="none";
}
</script>
</body>
</html>
